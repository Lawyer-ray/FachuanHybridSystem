# ============================================================
# 法穿案件管理系统 - Docker 部署配置
# ============================================================
# 
# 使用说明：
# 1. 复制此文件为 .env（放在项目根目录）
# 2. 修改 DJANGO_SECRET_KEY（生产环境必须修改！）
# 3. 运行 docker-compose up -d
#
# 配置管理：
# - 基础配置：本文件（Docker 启动必需）
# - 业务配置：Admin 后台 -> 核心系统 -> 系统配置
#

# ============================================================
# Django 核心配置（必需）
# ============================================================

# Django 密钥（生产环境必须修改！）
# 生成命令（选择任一方式）:
#   openssl rand -base64 50
#   head -c 50 /dev/urandom | base64
# 警告：使用默认密钥会导致安全风险！
DJANGO_SECRET_KEY=change-me-in-production-use-generated-key

# 调试模式
# - 开发环境: True（显示详细错误信息）
# - 生产环境: False（隐藏敏感信息）
DJANGO_DEBUG=False

# 允许的主机（多个用逗号分隔）
# 生产环境请添加你的域名，例如: example.com,www.example.com
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1

# ============================================================
# 数据库配置
# ============================================================

# SQLite 数据库路径（Docker 内部路径，通常不需要修改）
# 数据会持久化到 Docker Volume: fachuang-db
DATABASE_PATH=/app/data/db.sqlite3

# ============================================================
# Redis 配置
# ============================================================

# Redis 连接 URL（Docker 内部服务名）
# 格式: redis://[password@]host:port/db
REDIS_URL=redis://redis:6379/0

# ============================================================
# 应用版本（自动设置，通常不需要修改）
# ============================================================

APP_VERSION=1.0.0

# ============================================================
# 安全配置（生产环境重要）
# ============================================================

# CORS 允许的来源（生产环境配置你的前端域名）
# 多个来源用逗号分隔，例如: https://example.com,https://app.example.com
# CORS_ALLOWED_ORIGINS=https://your-frontend.com

# CSRF 信任的来源（用于表单提交）
# 多个来源用逗号分隔
# CSRF_TRUSTED_ORIGINS=https://your-frontend.com

# ============================================================
# 可选：飞书配置（用于群聊通知）
# ============================================================
# 在飞书开放平台创建应用后获取
# 文档: https://open.feishu.cn/document/home/introduction-to-custom-app-development

# FEISHU_APP_ID=cli_xxxxxxxxxx
# FEISHU_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxx

# 飞书 Webhook URL（用于机器人消息）
# FEISHU_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx

# 默认群主 ID（创建群聊时使用）
# FEISHU_DEFAULT_OWNER_ID=ou_xxxxxxxxxxxxxxxx

# ============================================================
# 可选：钉钉配置
# ============================================================

# DINGTALK_APP_KEY=
# DINGTALK_APP_SECRET=
# DINGTALK_AGENT_ID=

# ============================================================
# 可选：企业微信配置
# ============================================================

# WECHAT_WORK_CORP_ID=
# WECHAT_WORK_AGENT_ID=
# WECHAT_WORK_SECRET=

# ============================================================
# 可选：AI 配置
# ============================================================

# Moonshot AI（用于智能命名等功能）
# 获取 API Key: https://platform.moonshot.cn/
# MOONSHOT_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx
# MOONSHOT_BASE_URL=https://api.moonshot.cn/v1

# Ollama 本地 AI（可选替代方案）
# 注意：Docker 中访问宿主机需要使用 host.docker.internal
# OLLAMA_MODEL=qwen3:0.6b
# OLLAMA_BASE_URL=http://host.docker.internal:11434

# ============================================================
# 可选：爬虫配置
# ============================================================

# 爬虫加密密钥（用于加密存储的账号密码）
# 生成命令: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# SCRAPER_ENCRYPTION_KEY=

# 爬虫是否使用无头模式（Docker 中必须为 True）
# SCRAPER_HEADLESS=True

# ============================================================
# 可选：法院短信处理配置
# ============================================================

# 最大重试次数
# COURT_SMS_MAX_RETRIES=3

# 重试延迟（秒）
# COURT_SMS_RETRY_DELAY=60

# 自动恢复失败任务
# COURT_SMS_AUTO_RECOVERY=True

# ============================================================
# Django-Q 任务队列配置（高级）
# ============================================================
# 通常不需要修改，除非有特殊性能需求

# Q_CLUSTER_WORKERS=2
# Q_CLUSTER_TIMEOUT=600
# Q_CLUSTER_RETRY=1200

# ============================================================
# 资源限制配置（高级）
# ============================================================
# 用于限制容器的 CPU 和内存使用
# 格式说明：
# - CPU: 核心数（如 1.0 表示 1 个核心，0.5 表示半个核心）
# - 内存: 支持 K, M, G 后缀（如 512M, 1G, 2G）

# Backend 服务资源限制
# BACKEND_CPU_LIMIT=2.0
# BACKEND_MEMORY_LIMIT=2G
# BACKEND_CPU_RESERVATION=0.5
# BACKEND_MEMORY_RESERVATION=512M

# Redis 服务资源限制
# REDIS_CPU_LIMIT=0.5
# REDIS_MEMORY_LIMIT=512M
# REDIS_CPU_RESERVATION=0.1
# REDIS_MEMORY_RESERVATION=128M

# Q-Cluster 服务资源限制
# QCLUSTER_CPU_LIMIT=1.0
# QCLUSTER_MEMORY_LIMIT=1G
# QCLUSTER_CPU_RESERVATION=0.25
# QCLUSTER_MEMORY_RESERVATION=256M

# ============================================================
# Gunicorn 配置（高级）
# ============================================================
# 用于调优 WSGI 服务器性能

# Worker 数量（默认: min(CPU核心数*2+1, 4)）
# GUNICORN_WORKERS=4

# 每个 Worker 的线程数
# GUNICORN_THREADS=4

# Worker 类型: sync, gthread, gevent
# GUNICORN_WORKER_CLASS=gthread

# 请求超时时间（秒）
# GUNICORN_TIMEOUT=120

# Worker 处理请求数上限（防止内存泄漏）
# GUNICORN_MAX_REQUESTS=1000

# 日志级别: debug, info, warning, error, critical
# GUNICORN_LOG_LEVEL=info

# ============================================================
# 日志配置（高级）
# ============================================================

# 日志级别: DEBUG, INFO, WARNING, ERROR, CRITICAL
# LOG_LEVEL=INFO

# ============================================================
# 注意事项
# ============================================================
#
# 1. 安全性
#    - 生产环境必须修改 DJANGO_SECRET_KEY
#    - 生产环境设置 DJANGO_DEBUG=False
#    - 配置 CORS_ALLOWED_ORIGINS 限制跨域访问
#
# 2. 数据持久化
#    - 数据库文件存储在 Docker Volume: fachuang-db
#    - 媒体文件存储在 Docker Volume: fachuang-media
#    - 日志文件存储在 Docker Volume: fachuang-logs
#
# 3. 备份建议
#    - 定期备份 Docker Volume 数据
#    - 备份命令: docker cp fachuang-backend:/app/data/db.sqlite3 ./backup/
#
# 4. 更新系统
#    - git pull
#    - docker-compose build
#    - docker-compose up -d
#
