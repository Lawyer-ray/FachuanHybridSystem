# Django Admin æµ‹è¯•ç™»å½•åŠŸèƒ½æŒ‡å—

## åŠŸèƒ½è¯´æ˜

åœ¨ Django Admin åå°ç›´æ¥æµ‹è¯•å…¨å›½æ³•é™¢"ä¸€å¼ ç½‘"çš„ç™»å½•åŠŸèƒ½ï¼Œæ— éœ€ç¼–å†™ä»£ç æˆ–è¿è¡Œè„šæœ¬ã€‚

## ä½¿ç”¨æ­¥éª¤

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
make run
```

### 2. è®¿é—® Django Admin

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://127.0.0.1:8002/admin

ä½¿ç”¨è¶…çº§ç”¨æˆ·è´¦å·ç™»å½•ã€‚

### 3. æ·»åŠ è´¦å·å‡­è¯

å¯¼èˆªåˆ°ï¼š**ç»„ç»‡ç®¡ç† â†’ è´¦å·å¯†ç **

ç‚¹å‡»"æ·»åŠ è´¦å·å¯†ç "ï¼Œå¡«å†™ä¿¡æ¯ï¼š
- **å¾‹å¸ˆ**ï¼šé€‰æ‹©ä¸€ä¸ªå¾‹å¸ˆ
- **ç½‘ç«™åç§°**ï¼šå…¨å›½æ³•é™¢ä¸€å¼ ç½‘
- **URL**ï¼šhttps://zxfw.court.gov.cn
- **è´¦å·**ï¼šä½ çš„è´¦å·
- **å¯†ç **ï¼šä½ çš„å¯†ç 

ç‚¹å‡»"ä¿å­˜"ã€‚

### 4. æµ‹è¯•ç™»å½•

åœ¨è´¦å·å¯†ç åˆ—è¡¨é¡µï¼Œæ‰¾åˆ°åˆšæ‰æ·»åŠ çš„å‡­è¯ï¼Œç‚¹å‡»å³ä¾§çš„ **ğŸ” æµ‹è¯•ç™»å½•** æŒ‰é’®ã€‚

### 5. è§‚å¯Ÿæµ‹è¯•è¿‡ç¨‹

ç³»ç»Ÿä¼šï¼š
1. âœ… è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨çª—å£ï¼ˆæœ‰å¤´æ¨¡å¼ï¼‰
2. âœ… å¯¼èˆªåˆ°ç™»å½•é¡µ
3. âœ… è‡ªåŠ¨è¾“å…¥è´¦å·å¯†ç 
4. âœ… è‡ªåŠ¨è¯†åˆ«éªŒè¯ç 
5. âœ… è‡ªåŠ¨ç‚¹å‡»ç™»å½•
6. âœ… æ£€æŸ¥ç™»å½•ç»“æœ
7. âœ… åœç•™ 10 ç§’ä¾›è§‚å¯Ÿ
8. âœ… è‡ªåŠ¨å…³é—­æµè§ˆå™¨

**æ³¨æ„ï¼š** è¯·ä¸è¦æ‰‹åŠ¨å…³é—­æµè§ˆå™¨çª—å£ï¼Œè®©å®ƒè‡ªåŠ¨å®Œæˆã€‚

### 6. æŸ¥çœ‹æµ‹è¯•ç»“æœ

æµ‹è¯•å®Œæˆåï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„ç»“æœé¡µé¢ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **ç™»å½•çŠ¶æ€**ï¼šæˆåŠŸæˆ–å¤±è´¥
- ğŸ“ **æ‰§è¡Œæ—¥å¿—**ï¼šè¯¦ç»†çš„æ“ä½œæ­¥éª¤
- ğŸ“¸ **è°ƒè¯•æˆªå›¾**ï¼šæœ€æ–°çš„ 5 å¼ æˆªå›¾
- âŒ **é”™è¯¯è¯¦æƒ…**ï¼šå¦‚æœå¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯å †æ ˆ

---

## åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨éªŒè¯ç è¯†åˆ«

ä½¿ç”¨ `ddddocr` è‡ªåŠ¨è¯†åˆ«éªŒè¯ç ï¼š
- è¯†åˆ«ç‡çº¦ 70-80%
- å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š 5 æ¬¡ï¼‰
- æ¯æ¬¡é‡è¯•ä¼šåˆ·æ–°éªŒè¯ç 

### 2. è°ƒè¯•ä¿¡æ¯ä¿å­˜

æ‰€æœ‰è°ƒè¯•ä¿¡æ¯è‡ªåŠ¨ä¿å­˜ï¼š
- **æˆªå›¾**ï¼š`media/automation/screenshots/`
- **éªŒè¯ç å›¾ç‰‡**ï¼š`media/automation/debug/`
- **æ—¥å¿—**ï¼šæ˜¾ç¤ºåœ¨ç»“æœé¡µé¢

### 3. å¯è§†åŒ–æ“ä½œ

ä½¿ç”¨æœ‰å¤´æ¨¡å¼ï¼ˆ`headless=False`ï¼‰ï¼š
- å¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ“ä½œè¿‡ç¨‹
- æ–¹ä¾¿è°ƒè¯•å’Œè§‚å¯Ÿ
- æ“ä½œé€Ÿåº¦æ”¾æ…¢ï¼ˆ`slow_mo=500`ï¼‰

### 4. å‹å¥½çš„ç»“æœå±•ç¤º

ç»“æœé¡µé¢åŒ…å«ï¼š
- ğŸŸ¢ æˆåŠŸçŠ¶æ€ï¼ˆç»¿è‰²èƒŒæ™¯ï¼‰
- ğŸ”´ å¤±è´¥çŠ¶æ€ï¼ˆçº¢è‰²èƒŒæ™¯ï¼‰
- ğŸ“‹ è¯¦ç»†æ—¥å¿—
- ğŸ–¼ï¸ æˆªå›¾é¢„è§ˆï¼ˆç‚¹å‡»æŸ¥çœ‹å¤§å›¾ï¼‰
- ğŸ”„ é‡æ–°æµ‹è¯•æŒ‰é’®

---

## ç•Œé¢é¢„è§ˆ

### è´¦å·å¯†ç åˆ—è¡¨é¡µ

```
ID | ç½‘ç«™åç§°          | è´¦å·              | å¾‹å¸ˆ   | æµ‹è¯•ç™»å½•      | åˆ›å»ºæ—¶é—´
1  | å…¨å›½æ³•é™¢ä¸€å¼ ç½‘    | user@example.com  | å¼ ä¸‰   | [ğŸ” æµ‹è¯•ç™»å½•] | 2024-01-01
```

### æµ‹è¯•ç»“æœé¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµ‹è¯•ç™»å½•: å…¨å›½æ³•é™¢ä¸€å¼ ç½‘                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‡­è¯ä¿¡æ¯                                     â”‚
â”‚ - ç½‘ç«™åç§°: å…¨å›½æ³•é™¢ä¸€å¼ ç½‘                    â”‚
â”‚ - è´¦å·: user@example.com                    â”‚
â”‚ - å¾‹å¸ˆ: å¼ ä¸‰ (zhangsan)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ç™»å½•æˆåŠŸ                                  â”‚
â”‚ æ¶ˆæ¯: ç™»å½•æˆåŠŸ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰§è¡Œæ—¥å¿—                                     â”‚
â”‚ - å¼€å§‹æµ‹è¯•ç™»å½•: å…¨å›½æ³•é™¢ä¸€å¼ ç½‘                â”‚
â”‚ - è´¦å·: user@example.com                    â”‚
â”‚ - å¯åŠ¨æµè§ˆå™¨...                              â”‚
â”‚ - æµè§ˆå™¨å·²å¯åŠ¨                               â”‚
â”‚ - æœåŠ¡å®ä¾‹å·²åˆ›å»º                             â”‚
â”‚ - å¼€å§‹ç™»å½•...                                â”‚
â”‚ - ç™»å½•ç»“æœ: ç™»å½•æˆåŠŸ                         â”‚
â”‚ - ç­‰å¾… 10 ç§’ä¾›è§‚å¯Ÿ...                        â”‚
â”‚ - æµè§ˆå™¨å·²å…³é—­                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è°ƒè¯•æˆªå›¾                                     â”‚
â”‚ [æˆªå›¾1] [æˆªå›¾2] [æˆªå›¾3] [æˆªå›¾4] [æˆªå›¾5]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â† è¿”å›åˆ—è¡¨] [ç¼–è¾‘å‡­è¯] [ğŸ”„ é‡æ–°æµ‹è¯•]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¸¸è§é—®é¢˜

### Q1: ç‚¹å‡»"æµ‹è¯•ç™»å½•"åæ²¡æœ‰ååº”

**åŸå› ï¼š** æµè§ˆå™¨å¯èƒ½è¢«å¼¹çª—æ‹¦æˆª

**è§£å†³ï¼š**
1. æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸å¼¹çª—
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æ£€æŸ¥åç«¯æ—¥å¿—ï¼š`tail -f logs/api.log`

### Q2: éªŒè¯ç è¯†åˆ«å¤±è´¥

**åŸå› ï¼š** ddddocr è¯†åˆ«ç‡ä¸æ˜¯ 100%

**è§£å†³ï¼š**
- ç³»ç»Ÿä¼šè‡ªåŠ¨é‡è¯• 5 æ¬¡
- æŸ¥çœ‹éªŒè¯ç å›¾ç‰‡ï¼š`media/automation/debug/captcha_*.png`
- å¦‚æœå¤šæ¬¡å¤±è´¥ï¼Œè€ƒè™‘ä½¿ç”¨ä»˜è´¹ OCR æœåŠ¡

### Q3: æµè§ˆå™¨å¯åŠ¨å¤±è´¥

**åŸå› ï¼š** Playwright æµè§ˆå™¨æœªå®‰è£…

**è§£å†³ï¼š**
```bash
playwright install chromium
```

### Q4: æç¤º"ddddocr æœªå®‰è£…"

**è§£å†³ï¼š**
```bash
pip install ddddocr
```

### Q5: ç™»å½•æˆåŠŸä½†æ˜¾ç¤ºå¤±è´¥

**åŸå› ï¼š** ç™»å½•æˆåŠŸåˆ¤æ–­é€»è¾‘å¯èƒ½éœ€è¦è°ƒæ•´

**è§£å†³ï¼š**
1. æŸ¥çœ‹æˆªå›¾ï¼Œç¡®è®¤æ˜¯å¦çœŸçš„ç™»å½•æˆåŠŸ
2. å¦‚æœç¡®å®æˆåŠŸï¼Œä¿®æ”¹ `CourtZxfwService._check_login_success()` æ–¹æ³•
3. è°ƒæ•´åˆ¤æ–­é€»è¾‘

---

## æ‰©å±•åŠŸèƒ½

### æœªæ¥å¯ä»¥æ·»åŠ çš„åŠŸèƒ½

#### 1. æµ‹è¯•ç«‹æ¡ˆåŠŸèƒ½

åœ¨è´¦å·å¯†ç åˆ—è¡¨é¡µæ·»åŠ "æµ‹è¯•ç«‹æ¡ˆ"æŒ‰é’®ï¼š

```python
@admin.display(description="æµ‹è¯•ç«‹æ¡ˆ")
def test_filing_button(self, obj):
    url = reverse('admin:organization_accountcredential_test_filing', args=[obj.id])
    return format_html(
        '<a class="button" href="{}">ğŸ“ æµ‹è¯•ç«‹æ¡ˆ</a>',
        url
    )
```

#### 2. æµ‹è¯•æŸ¥è¯¢åŠŸèƒ½

æ·»åŠ "æµ‹è¯•æŸ¥è¯¢"æŒ‰é’®ï¼š

```python
@admin.display(description="æµ‹è¯•æŸ¥è¯¢")
def test_query_button(self, obj):
    url = reverse('admin:organization_accountcredential_test_query', args=[obj.id])
    return format_html(
        '<a class="button" href="{}">ğŸ” æµ‹è¯•æŸ¥è¯¢</a>',
        url
    )
```

#### 3. æ‰¹é‡æµ‹è¯•

åœ¨åˆ—è¡¨é¡µæ·»åŠ æ‰¹é‡æ“ä½œï¼š

```python
@admin.action(description="æ‰¹é‡æµ‹è¯•ç™»å½•")
def batch_test_login(self, request, queryset):
    # æ‰¹é‡æµ‹è¯•å¤šä¸ªè´¦å·
    pass
```

#### 4. å®šæ—¶æµ‹è¯•

æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨æµ‹è¯•æ‰€æœ‰è´¦å·ï¼š

```python
# tasks.py
def auto_test_all_credentials():
    """å®šæ—¶æµ‹è¯•æ‰€æœ‰è´¦å·å‡­è¯"""
    credentials = AccountCredential.objects.all()
    for credential in credentials:
        # æµ‹è¯•ç™»å½•
        pass
```

---

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒä»£ç 

```python
# apps/organization/admin.py

@admin.register(AccountCredential)
class AccountCredentialAdmin(admin.ModelAdmin):
    
    def get_urls(self):
        """æ·»åŠ è‡ªå®šä¹‰ URL"""
        urls = super().get_urls()
        custom_urls = [
            path(
                '<int:credential_id>/test-login/',
                self.admin_site.admin_view(self.test_login_view),
                name='organization_accountcredential_test_login',
            ),
        ]
        return custom_urls + urls
    
    def test_login_view(self, request, credential_id):
        """æµ‹è¯•ç™»å½•è§†å›¾"""
        # 1. è·å–å‡­è¯
        credential = AccountCredential.objects.get(id=credential_id)
        
        # 2. å¯åŠ¨æµè§ˆå™¨
        with sync_playwright() as p:
            browser = p.chromium.launch(headless=False)
            context = browser.new_context()
            page = context.new_page()
            
            # 3. åˆ›å»ºæœåŠ¡
            service = CourtZxfwService(page, context)
            
            # 4. æ‰§è¡Œç™»å½•
            result = service.login(
                account=credential.account,
                password=credential.password,
                save_debug=True
            )
            
            # 5. è¿”å›ç»“æœ
            return TemplateResponse(request, "admin/organization/test_login_result.html", {
                "credential": credential,
                "result": result,
            })
```

---

## ä¼˜åŠ¿

### 1. æ— éœ€ç¼–å†™ä»£ç 
- ç›´æ¥åœ¨ Admin åå°æ“ä½œ
- ç‚¹å‡»æŒ‰é’®å³å¯æµ‹è¯•
- é€‚åˆéæŠ€æœ¯äººå‘˜ä½¿ç”¨

### 2. å¯è§†åŒ–æ“ä½œ
- å¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ“ä½œè¿‡ç¨‹
- æ–¹ä¾¿è°ƒè¯•å’Œè§‚å¯Ÿ
- æˆªå›¾è‡ªåŠ¨ä¿å­˜

### 3. è¯¦ç»†çš„ç»“æœå±•ç¤º
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- è¯¦ç»†æ—¥å¿—
- æˆªå›¾é¢„è§ˆ
- é”™è¯¯å †æ ˆ

### 4. æ˜“äºæ‰©å±•
- å¯ä»¥æ·»åŠ æ›´å¤šæµ‹è¯•åŠŸèƒ½
- å¯ä»¥æ·»åŠ æ‰¹é‡æµ‹è¯•
- å¯ä»¥æ·»åŠ å®šæ—¶æµ‹è¯•

---

## æ€»ç»“

é€šè¿‡ Django Admin çš„è‡ªå®šä¹‰ Action å’Œè§†å›¾ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

1. âœ… åœ¨åå°ç›´æ¥æµ‹è¯•ç™»å½•åŠŸèƒ½
2. âœ… å¯è§†åŒ–çš„æ“ä½œè¿‡ç¨‹
3. âœ… è¯¦ç»†çš„ç»“æœå±•ç¤º
4. âœ… è‡ªåŠ¨ä¿å­˜è°ƒè¯•ä¿¡æ¯
5. âœ… å‹å¥½çš„ç”¨æˆ·ç•Œé¢

**æœªæ¥å¯ä»¥æ‰©å±•åˆ°æµ‹è¯•ç«‹æ¡ˆã€æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œæ‰€æœ‰æ“ä½œéƒ½åœ¨ Admin åå°å®Œæˆï¼** ğŸ‰
