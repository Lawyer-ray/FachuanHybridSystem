{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block content_title %}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1>Tokenè·å–å†å²è®°å½•</h1>
        <div>
            <a href="{% url 'admin:automation_tokenacquisitionhistory_dashboard' %}" 
               class="button default" style="margin-right: 10px;">
                ğŸ“Š æŸ¥çœ‹ä»ªè¡¨æ¿
            </a>
        </div>
    </div>
    
    {% if statistics %}
    <div class="module" style="margin-bottom: 20px;">
        <h2>ğŸ“Š ç»Ÿè®¡æ¦‚è§ˆ</h2>
        <div style="display: flex; gap: 20px; flex-wrap: wrap; padding: 15px;">
            <!-- æ€»ä½“ç»Ÿè®¡ -->
            <div class="card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; min-width: 200px;">
                <h3 style="margin: 0 0 10px 0; color: #495057;">ğŸ“ˆ æ€»ä½“ç»Ÿè®¡</h3>
                <div style="font-size: 14px; line-height: 1.6;">
                    <div><strong>æ€»è®°å½•æ•°:</strong> {{ statistics.total_records }}</div>
                    <div><strong>æˆåŠŸè®°å½•:</strong> <span style="color: #28a745;">{{ statistics.success_records }}</span></div>
                    <div><strong>æˆåŠŸç‡:</strong> 
                        <span style="color: {% if statistics.success_rate >= 80 %}#28a745{% elif statistics.success_rate >= 50 %}#ffc107{% else %}#dc3545{% endif %}; font-weight: bold;">
                            {{ statistics.success_rate|floatformat:1 }}%
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- æœ€è¿‘24å°æ—¶ -->
            <div class="card" style="background: #e3f2fd; padding: 15px; border-radius: 8px; min-width: 200px;">
                <h3 style="margin: 0 0 10px 0; color: #1976d2;">ğŸ• æœ€è¿‘24å°æ—¶</h3>
                <div style="font-size: 14px; line-height: 1.6;">
                    <div><strong>è·å–æ¬¡æ•°:</strong> {{ statistics.recent_count }}</div>
                    <div><strong>æˆåŠŸæ¬¡æ•°:</strong> <span style="color: #28a745;">{{ statistics.recent_success }}</span></div>
                    {% if statistics.recent_count > 0 %}
                    <div><strong>æˆåŠŸç‡:</strong> 
                        {% if statistics.recent_count > 0 %}
                            {% widthratio statistics.recent_success statistics.recent_count 100 as recent_rate %}
                            <span style="color: {% if recent_rate >= 80 %}#28a745{% elif recent_rate >= 50 %}#ffc107{% else %}#dc3545{% endif %}; font-weight: bold;">
                                {{ recent_rate }}%
                            </span>
                        {% else %}
                            <span style="color: #999;">-</span>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- æ€§èƒ½æŒ‡æ ‡ -->
            <div class="card" style="background: #f3e5f5; padding: 15px; border-radius: 8px; min-width: 200px;">
                <h3 style="margin: 0 0 10px 0; color: #7b1fa2;">âš¡ æ€§èƒ½æŒ‡æ ‡</h3>
                <div style="font-size: 14px; line-height: 1.6;">
                    <div><strong>å¹³å‡è€—æ—¶:</strong> 
                        <span style="font-weight: bold;">
                            {{ statistics.avg_duration|floatformat:1 }}ç§’
                        </span>
                    </div>
                    <div><strong>æ€§èƒ½è¯„çº§:</strong>
                        <span style="font-weight: bold;">è‰¯å¥½</span>
                    </div>
                </div>
            </div>
            
            <!-- å¿«é€Ÿæ“ä½œ -->
            <div class="card" style="background: #fff3e0; padding: 15px; border-radius: 8px; min-width: 200px;">
                <h3 style="margin: 0 0 10px 0; color: #f57c00;">ğŸ”§ å¿«é€Ÿæ“ä½œ</h3>
                <div style="font-size: 14px; line-height: 1.6;">
                    <div style="margin-bottom: 8px;">
                        <a href="{% url 'admin:organization_accountcredential_changelist' %}" 
                           style="color: #007bff; text-decoration: none;">
                            ğŸ”‘ ç®¡ç†è´¦å·å‡­è¯
                        </a>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <a href="{% url 'admin:automation_courttoken_changelist' %}" 
                           style="color: #007bff; text-decoration: none;">
                            ğŸ« æŸ¥çœ‹TokençŠ¶æ€
                        </a>
                    </div>
                    <div>
                        <a href="{% url 'admin:automation_preservationquote_changelist' %}" 
                           style="color: #007bff; text-decoration: none;">
                            ğŸ’° è´¢äº§ä¿å…¨è¯¢ä»·
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block result_list %}
    {% if statistics.total_records == 0 %}
    <div class="module" style="text-align: center; padding: 40px;">
        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ¯</div>
        <h2 style="color: #666; margin-bottom: 10px;">æš‚æ— Tokenè·å–è®°å½•</h2>
        <p style="color: #999; margin-bottom: 20px;">
            å½“ç³»ç»Ÿéœ€è¦è·å–Tokenæ—¶ï¼Œç›¸å…³è®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œã€‚
        </p>
        <div style="margin-top: 20px;">
            <a href="{% url 'admin:organization_accountcredential_changelist' %}" 
               class="button default" style="margin-right: 10px;">
                é…ç½®è´¦å·å‡­è¯
            </a>
            <a href="{% url 'admin:automation_preservationquote_changelist' %}" 
               class="button">
                åˆ›å»ºè¯¢ä»·ä»»åŠ¡
            </a>
        </div>
    </div>
    {% else %}
        {{ block.super }}
    {% endif %}
{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .card {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .card {
                min-width: 100% !important;
                margin-bottom: 10px;
            }
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-success { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-danger { background-color: #dc3545; }
    </style>
{% endblock %}